# EM data structures test task

Автор: Степан Остапенко.

## Программа

#### Использование

Проект запускается с помощью gradle.

Для замеров необходимо производить операции с файлами, поэтому для работы программе
необходимо знать путь до папки, расположенной на диске, и в которой можно свободно
производить стандартные операции с файлами, например, создание файла, чтение содержимого,
изменение и удаление файла. \
По желанию можно указать размер тестовых данных и количество проводимых тестов.
По умолчанию размер тестовых данных равен 128 мегабайт, а количество тестов равно 5.

Перед началом работы программы на диске должно быть достаточно свободного места для размещения
всех тестовых данных.

Запуск из командной строки: \
`gradle run --args="<путь до вышеописанной папки> [размер тестовых данных в мегабайтах] [количество тестов]"`

#### Процесс работы

В процессе работы программа делает несколько измерений. Каждое измерение представляет собой
создание некоторого количества временных файлов, имеющих суммарный размер равный размеру
тестовых данных, запись случайных данных в эти файлы и считывание данных из этих файлов.
Собственно, скорость чтения и записи измеряется как раз в этот момент. Для повышения точности
измерений, каждая пара запись/чтение выполняется заданное количество раз, после чего по каждому
показателю берется среднее значение. Помимо этого запись и чтение проходят в случайном порядке.

Более конкретно, программа пытается поделить тестовые данные на 1, 2, 3, 4, 5, 10, 20, 50 и 100
файлов. Если размер тестовых данных слишком мал, чтобы его можно было разделить на некоторое
количество файлов, данное измерение пропускается.

По завершении работы все временные файлы удаляются с диска.

#### Формат результата

Для каждого измерения программа печатает в стандартный поток вывода количество файлов, на которые
были разделены тестовые данные, суммарный объем тестовых данных и результаты измерения.

## Запуск на SSD диске компьютера

При запуске на локальном SSD диске были получены следующие результаты:

```
Test data with total size of 256 MB was split into 1 file(s)
Read speed is 657 MB/s and write speed is 475 MB/s

Test data with total size of 256 MB was split into 2 file(s)
Read speed is 719 MB/s and write speed is 268 MB/s

Test data with total size of 256 MB was split into 3 file(s)
Read speed is 685 MB/s and write speed is 192 MB/s

Test data with total size of 256 MB was split into 4 file(s)
Read speed is 648 MB/s and write speed is 199 MB/s

Test data with total size of 256 MB was split into 5 file(s)
Read speed is 665 MB/s and write speed is 181 MB/s

Test data with total size of 256 MB was split into 10 file(s)
Read speed is 650 MB/s and write speed is 165 MB/s

Test data with total size of 256 MB was split into 20 file(s)
Read speed is 633 MB/s and write speed is 140 MB/s

Test data with total size of 256 MB was split into 50 file(s)
Read speed is 659 MB/s and write speed is 115 MB/s

Test data with total size of 256 MB was split into 100 file(s)
Read speed is 487 MB/s and write speed is 90 MB/s
```

Каждое измерение содержало 20 экспериментов. Также результаты можно найти в файле `results.txt`.

Можно видеть, что скорость записи значительно меньше скорости чтения, а также то, что
скорость записи уменьшается с увеличением количества файлов, в то время как скорость чтения
не меняется.

Первый факт я не могу самостоятельно обосновать. Скажу лишь, что, действительно, при тестах
скорости SSD диска скорость чтения получается примерно в два раза выше скорости записи.

Второй факт можно обосновать тем, что для записи одного файла могут потребоваться некоторые
накладные расходы, помимо расходов на саму запись. В связи с этим, выгоднее записывать на
диск один большой файл, а не много маленьких файлов с суммарным размером равным размеру
большого файла. При этом, на чтение файлов дополнительных накладных расходов почти не
требуется, поэтому чтение одного большого файла занимает столько времени, сколько и чтение
большого числа маленьких файлов.